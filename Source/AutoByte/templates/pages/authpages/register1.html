{% load static %}
<!DOCTYPE html>
<html lang="en">

    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Skydash Admin</title>
        <!-- plugins:css -->
        <link rel="stylesheet" href="{% static 'vendors/feather/feather.css' %}">
        <link rel="stylesheet" href="{% static 'vendors/ti-icons/css/themify-icons.css' %}">
        <link rel="stylesheet" href="{% static 'vendors/css/vendor.bundle.base.css' %}">
        <!-- endinject -->
        <!-- Plugin css for this page -->
        <!-- End plugin css for this page -->
        <!-- inject:css -->
        <link rel="stylesheet" href="{% static 'css/vertical-layout-light/style.css' %}">
        <!-- endinject -->
        <link rel="shortcut icon" href="{% static 'images/favicon.png' %}" />
    </head>

    <body>
        <div class="container-scroller">
            <div class="container-fluid page-body-wrapper full-page-wrapper">
                <div class="content-wrapper d-flex align-items-center auth px-0">
                    <div class="row w-100 mx-0">
                        <div class="col-lg-4 mx-auto">
                            <div class="auth-form-light text-left py-5 px-4 px-sm-5">
                                <div class="brand-logo">
                                    <img src="{% static 'images/logo.svg' %}" alt="logo">
                                </div>
                                <h4>Now you need a Username ?</h4>
                                <h6 class="font-weight-light">Last step</h6>
                                <form action="{% url 'register1' %}" method="post" id="formUsrnam" class="pt-3">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <input type="text" class="form-control form-control-lg" id="firstnameinput"
                                            name="uname" placeholder="Username">
                                        <div id="fnameErr" class=""></div>
                                    </div>
                                    <div class="mt-3">
                                        <input type="submit"
                                            class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn"
                                            value="CONTINUE">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- content-wrapper ends -->
            </div>
            <!-- page-body-wrapper ends -->
        </div>
        <!-- container-scroller -->
        <!-- plugins:js -->
        <script src="{% static 'vendors/js/vendor.bundle.base.js' %}"></script>
        <!-- endinject -->
        <!-- Plugin js for this page -->
        <!-- End plugin js for this page -->
        <!-- inject:js -->
        <script src="{% static 'js/off-canvas.js' %}"></script>
        <script src="{% static 'js/hoverable-collapse.js' %}"></script>
        <script src="{% static 'js/template.js' %}"></script>
        <script src="{% static 'js/settings.js' %}"></script>
        <script src="{% static 'js/todolist.js' %}"></script>
        <!-- endinject -->
        <!-- <script src="{% static 'dev_js/tagids.js' %}"></script>
  <script src="{% static 'dev_js/validations.js' %}"></script>
  <script src="{% static 'dev_js/registration.js' %}"></script> -->
        <script>
            var condition = false;
            var usernameInput = document.getElementById('firstnameinput');
            document.addEventListener("DOMContentLoaded", function() {
                usernameInput.addEventListener("input", function () {
                var usernameInput_value = usernameInput.value.trim();
                if (usernameInput.length != 0) {
                    fetch(`/check_username_exists/?username=${usernameInput_value}`)
                    .then((response) => response.json())
                    .then((data) => {
                        const bool = data.exists;
                        if (bool){
                            document.getElementById('fnameErr').classList.add('invalid-feedback');
                            usernameInput.classList.add('is-invalid')
                            document.getElementById('fnameErr').textContent = "Username Exists";
                            condition = false;
                        }else{
                            document.getElementById('fnameErr').classList.remove('invalid-feedback');
                            usernameInput.classList.remove('is-invalid')
                            document.getElementById('fnameErr').textContent = "";
                            condition = true;
                            console.log(`Doesn't Exists`);
                        }
                    })
                }
            });  
            })

            document.getElementById('formUsrnam').addEventListener("submit", function(event){
                event.preventDefault();
                if (condition){
                    document.getElementById('formUsrnam').submit();
                    return condition;
                }else{
                    return condition;
                }
            });
        </script>
    </body>

</html>